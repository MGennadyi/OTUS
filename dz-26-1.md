 # Разворачивание High Availability PostgreSQL-HA от bitnami в связке repmgr+pgpool.
1. Подготовка: установка Google cloud SDK и Kubectl
```
sudo apt-get install apt-transport-https ca-certificates gnupg
echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key --keyring /usr/share/keyrings/cloud.google.gpg add -
sudo apt-get update && sudo apt-get install google-cloud-sdk
```
Ответ № 1:
Fetching cluster endpoint and auth data.
kubeconfig entry generated for postgresha.
Ответ № 2:
WARNING: Could not open the configuration file: [/root/.config/gcloud/configurations/config_default].
ERROR: (gcloud.container.clusters.get-credentials) You do not currently have an active account selected.
Please run:

  $ gcloud auth login

to obtain new credentials.

If you have already logged in with a different account:

    $ gcloud config set account ACCOUNT

to select an already authenticated account to use.
```

Разворачиваем через web-интерфейс: goole console/navigation menu/Kubernetes engine/clusters/create. Все по дефолту, кроме имени=postgresha
При этом изначально gcloud не имеет доступ к кластеру GKE. Для этого проинициализируем:
```
gcloud container clusters get-credentials postgresha --zone us-central1-c
```
где: 
postgresha - имя GKE;
--zone us-central1-c зона расположения GKE;

Добавить репозиторий helm
```
helm repo add bitnami https://charts.bitnami.com/bitnami
```
Ответ:

"bitnami" has been added to your repositories

Разорачивание кластера по умолчанию в 1 команду:
```
helm install pgsql-ha bitnami/postgresql-ha
```
