# Настройка autovacuum для достижения максимального уровня производительности

1. Запустить нагрузочный тест pgbench

2. Настроить параметры autovacuum для достижения максимального уровня устойчивой производительности

3. Создать GCE инстанс типа e2-medium и standard disk 10GB

4. Установить на него PostgreSQL 13 с дефолтными настройками

5. Применить параметры настройки PostgreSQL из прикрепленного к материалам занятия файла:

Параметры железа:
RAM = 4 GB;
CPUs = 1;
Data Storage = hdd;

Параметры postgresql.conf:
```
max_connections = 40

shared_buffers = 1GB

effective_cache_size = 3GB

maintenance_work_mem = 512MB

checkpoint_completion_target = 0.9

wal_buffers = 16MB

default_statistics_target = 500

random_page_cost = 4

effective_io_concurrency = 2

work_mem = 6553kB

min_wal_size = 4GB

max_wal_size = 16GB
```
6. Предварительная подготовка таблиц, т.е. создание и наполнение: запуск pgbench с ключом -i (инициализация) из-под postgres
```
pgbench -i -s1 postgres
```

8. Запуск теста: 
```
pgbench -c8 -P 10 -T 600 -U postgres postgres
```
10. Настрока autovacuum максимально эффективно:
```
autovacuum_max_workers = 1 # = кол-во CPU/2

```

11. Построить график по получившимся значениям так, чтобы получить максимально ровное значение tps
