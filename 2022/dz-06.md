# Кластер Patroni on-premise.
##### 0. Установка postgresql-14.
##### 1. Установка ETCD:
```
apt install etcd -y
rm -rf /var/lib/etcd/*
mkdir /var/lib/etcd
ls -l /var/lib/
sudo chown -R etcd /var/lib/etcd
vim /etc/default/etcd
systemctl stop etcd
vim /etc/default/etcd
```
ETCD_NAME="etcd1"
ETCD_LISTEN_CLIENT_URLS="http://0.0.0.0:2379"
ETCD_ADVERTISE_CLIENT_URLS="http://192.168.0.41:2379"
ETCD_LISTEN_PEER_URLS="http://0.0.0.0:2380"
ETCD_INITIAL_ADVERTISE_PEER_URLS="http://192.168.0.41:2380"
ETCD_INITIAL_CLUSTER_TOKEN="testcluster"
ETCD_INITIAL_CLUSTER="etcd1=http://192.168.0.41:2380,etcd2=http://192.168.0.42:2380,etcd3=http://192.168.0.43:2380"
ETCD_INITIAL_CLUSTER_STATE="new"
ETCD_DATA_DIR="/var/lib/etcd"
ETCD_ELECTION_TIMEOUT="5000"
ETCD_HEARTBEAT_INTERVAL="1000"


##### 2. Установка PATRONI

```
sudo passwd root
12345

sudo apt-get install gnupg1 gnupg2 -y
sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
sudo wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
sudo apt update
sudo apt-get install postgresql-14 -y
pg_isready
systemctl status postgresql
systemctl start postgresql
sudo apt-get install -y python3 python3-pip git
sudo pip3 install psycopg2-binary
systemctl stop postgresql
sudo -u postgres pg_dropcluster 14 main
pg_dropcluster 14 main
pg_lsclusters





















su postgres
```































